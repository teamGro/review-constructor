(function(){"use strict";var t={4991:function(t,o,i){var e=i(9242),n=i(3396);const c={class:"container"},r=["disabled"];function l(t,o,i,e,l,s){const d=(0,n.up)("block-element"),u=(0,n.up)("arrow-element"),a=(0,n.up)("v-layer"),f=(0,n.up)("v-stage");return(0,n.wg)(),(0,n.iD)("div",c,[(0,n._)("button",{class:"btn btn-start",disabled:s.computedFirstBlockExist,onClick:o[0]||(o[0]=(...t)=>s.drawBlock&&s.drawBlock(...t))}," Начать ",8,r),(0,n.Wm)(f,{config:l.configKonva},{default:(0,n.w5)((()=>[(0,n.Wm)(a,null,{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(s.computedBlocks,(t=>((0,n.wg)(),(0,n.j4)(d,{key:t.id,config:t},null,8,["config"])))),128)),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(s.computedConnectors,(t=>((0,n.wg)(),(0,n.j4)(u,{key:t.id,config:t},null,8,["config"])))),128))])),_:1})])),_:1},8,["config"])])}var s=i(65);function d(t,o,i,e,c,r){const l=(0,n.up)("v-rect"),s=(0,n.up)("v-text"),d=(0,n.up)("v-circle"),u=(0,n.up)("block-menu-element"),a=(0,n.up)("v-group");return(0,n.wg)(),(0,n.j4)(a,{config:i.config,onClick:r.drawChildrenBlock,onDragmove:r.moveBlock,onMousemove:r.onMouseMove,onMouseout:r.onMouseOut},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{config:i.config.rect},null,8,["config"]),(0,n.Wm)(s,{config:i.config.text},null,8,["config"]),(0,n.Wm)(d,{config:c.circleTopConfig},null,8,["config"]),(0,n.Wm)(d,{config:c.circleLeftConfig},null,8,["config"]),(0,n.Wm)(d,{config:c.circleRightConfig},null,8,["config"]),(0,n.Wm)(d,{config:c.circleBottomConfig},null,8,["config"]),(0,n.Wm)(u,{"group-visibility":c.blockVisibility,"onShow:title":r.showTitle,"onChange:title":r.changeTitle,"onRemove:block":r.removeBlock,"onAdd:block":r.addBlock},null,8,["group-visibility","onShow:title","onChange:title","onRemove:block","onAdd:block"])])),_:1},8,["config","onClick","onDragmove","onMousemove","onMouseout"])}function u(t,o,i,e,c,r){const l=(0,n.up)("v-text"),s=(0,n.up)("v-group");return(0,n.wg)(),(0,n.j4)(s,{config:r.computedGroupConfig},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{config:c.showTitleConfig,onClick:r.showTitle},null,8,["config","onClick"]),(0,n.Wm)(l,{config:c.changeTitleConfig,onClick:r.changeTitle},null,8,["config","onClick"]),(0,n.Wm)(l,{config:c.removeBlockConfig,onClick:r.removeBlock},null,8,["config","onClick"]),(0,n.Wm)(l,{config:c.addBlockConfig,onClick:r.addBlock},null,8,["config","onClick"])])),_:1},8,["config"])}const a={show:"show:title",change:"change:title",remove:"remove:block",add:"add:block"};var f={props:{groupVisibility:{type:Boolean,default:!1}},data(){return{groupConfig:{x:80,y:80,width:100,height:50},showTitleConfig:{x:0,y:0,text:"st",fontSize:20,fill:"black",fontFamily:"Calibri"},changeTitleConfig:{x:20,y:0,text:"ct",fontSize:20,fill:"black",fontFamily:"Calibri"},removeBlockConfig:{x:40,y:0,text:"rb",fontSize:20,fill:"black",fontFamily:"Calibri"},addBlockConfig:{x:60,y:0,text:"ab",fontSize:20,fill:"black",fontFamily:"Calibri"}}},emits:Object.values(a),methods:{showTitle(){this.$emit(a.show)},changeTitle(){this.$emit(a.change)},removeBlock(){this.$emit(a.remove)},addBlock(){this.$emit(a.add)}},computed:{computedGroupConfig(){return{...this.groupConfig,visible:this.groupVisibility}}}},h=i(89);const g=(0,h.Z)(f,[["render",u]]);var p=g,m={components:{BlockMenuElement:p},props:{config:{type:Object}},data(){return{circleTopConfig:{x:this.config.width/2,y:0,radius:10,fill:"red",opacity:0},circleLeftConfig:{x:0,y:this.config.height/2,radius:10,fill:"red",opacity:0},circleRightConfig:{x:this.config.width,y:this.config.height/2,radius:10,fill:"red",opacity:0},circleBottomConfig:{x:this.config.width/2,y:this.config.height,radius:10,fill:"red",opacity:0},blockVisibility:!1}},methods:{drawChildrenBlock(){this.blockVisibility=!this.blockVisibility},getConnectorPoints(t,o){const i=t.position(),e=o.position();return[i.x+t.attrs.width/2,i.y+t.attrs.height,e.x+o.attrs.width/2,e.y]},moveBlock(t){this.$store.commit("updateBlock",t.target.attrs)},onMouseMove(){this.circleTopConfig.opacity=1,this.circleLeftConfig.opacity=1,this.circleRightConfig.opacity=1,this.circleBottomConfig.opacity=1},onMouseOut(){this.circleTopConfig.opacity=0,this.circleLeftConfig.opacity=0,this.circleRightConfig.opacity=0,this.circleBottomConfig.opacity=0},showTitle(){alert(this.config.text.text)},changeTitle(){const t=prompt("enter new title");t&&this.$store.commit("updateTitle",{id:this.config.id,title:t})},removeBlock(){this.$store.commit("removeBlock",this.config.id)},addBlock(){const t=prompt("enter title");if(!t.trim())return;const o={...this.config,parentId:this.config.id,childrensId:[],y:this.config.y+200,title:t};this.$store.commit("addBlock",o),this.$emit("blocks:update")}},computed:{computedRectConfig(){return{...this.rectConfig,id:this.id}}}};const k=(0,h.Z)(m,[["render",d]]);var b=k;function w(t,o,i,e,c,r){const l=(0,n.up)("v-arrow");return(0,n.wg)(),(0,n.j4)(l,{ref:"arr",config:r.computedArrow},null,8,["config"])}var y={props:{config:{type:Object}},computed:{computedArrow(){return this.config}}};const v=(0,h.Z)(y,[["render",w]]);var C=v,x={name:"App",components:{BlockElement:b,ArrowElement:C},data(){return{pageWidth:null,pageHeight:null,configKonva:{width:window.innerWidth,height:window.innerHeight-60},isFirstBlockExist:!1,forceRenderKey:1}},methods:{drawBlock(){const t=prompt("enter title");console.log(t),t&&(this.$store.commit("addBlock",{title:t}),this.isFirstBlockExist=!0)}},computed:{...(0,s.Se)(["getBlocks"]),...(0,s.rn)(["blocks","connectors"]),computedBlocks(){return Array.from(this.blocks?.values()||[])},computedConnectors(){return Array.from(this.connectors?.values()||[])},computedFirstBlockExist(){return this.getBlocks.length>0}},mounted(){this.pageWidth=window.innerWidth,this.pageHeight=window.innerHeight-60}};const B=(0,h.Z)(x,[["render",l]]);var I=B;i(560);const T=window.innerWidth/2;class O{constructor(t){this.id=t.id,this.parentId=t.parentId??null,this.childrensId=t.childrensId??[],this.width=150,this.height=70,this.x=t.x??T-this.width/2,this.y=t.y??50,this.draggable=!0,this.rect=t.rect,this.text=t.text}}class W{constructor(t){this.id=t.id,this.name=t.name??null,this.from=t.from??null,this.to=t.to??null,this.points=t.points??[],this.fill="black",this.stroke="black"}set newPoints(t){this.points=t}}const M={rectDefaultSettings:{x:0,y:0,fill:"green",width:150,height:70,cornerRadius:10},textDefaultSettings:{x:0,y:0,fontSize:20,fontFamily:"Calibri",fill:"black",padding:10,align:"center",width:150}};var S=M;const j=50;var E=(0,s.MT)({state:{blocks:null,connectors:null,idCount:1,idConnectorCount:1},getters:{getBlocks(t){return Array.from(t.blocks?.values()||[])}},mutations:{addBlock(t,o){t.blocks?.size||(t.blocks=new Map);const i=`target-${t.idCount}`;if(o.rect=S.rectDefaultSettings,o.text=S.textDefaultSettings,o.text.text=o.title,t.blocks.set(i,new O({...o,id:i})),o.parentId){const e=t.blocks.get(o.parentId);if(e.childrensId.length){const o=t.blocks.get(e.childrensId[e.childrensId.length-1]);if(1===e.childrensId.length)t.blocks.get(i).x=o.x-o.width-j;else{const n=t.blocks.get(e.childrensId[e.childrensId.length-2]);e.childrensId.length%2===0?t.blocks.get(i).x=n.x+n.width+j:t.blocks.get(i).x=n.x-n.width-j,t.blocks.get(i).y=o.y}}e.childrensId.push(i),this.commit("addConnectors",t.blocks.get(i))}t.idCount++},addConnectors(t,o){t.connectors||(t.connectors=new Map);const i=`connector-${t.idConnectorCount}`,e=t.blocks.get(o.parentId),n=e.id,c=o.id,r=[e.x+e.width/2,e.y+e.height,o.x+o.width/2,o.y];t.connectors.set(i,new W({id:i,from:n,to:c,points:r})),t.idConnectorCount++},updateBlock(t,o){const i=t.blocks.get(o.id);if(i.x=o.x,i.y=o.y,!t.connectors?.size)return;let e=null;Array.from(t.connectors.values()).forEach((n=>{if(n.from===o.id){let o=i.childrensId?.find((t=>t===n.to));o&&(o=t.blocks.get(o),n.points=[i.x+i.width/2,i.y+i.height,o.x+o.width/2,o.y],e={...n},t.connectors.delete(e.id),t.connectors.set(e.id,e))}if(n.to===o.id){let o=i.parentId;o&&(o=t.blocks.get(o),n.points=[o.x+o.width/2,o.y+o.height,i.x+i.width/2,i.y],e={...n},t.connectors.delete(e.id),t.connectors.set(e.id,e))}}))},updateTitle(t,o){t.blocks.get(o.id).text.text=o.title},removeBlock(t,o){const i=t.blocks.get(o);let e=Array.from(t.connectors?.values()||[]),n=null;i.parentId&&(n=e.filter((t=>t.from===i.parentId&&t.to===i.id)),n?.length&&n.forEach((o=>{t.connectors.delete(o.id)})),t.blocks.get(i.parentId).childrensId=t.blocks.get(i.parentId).childrensId.filter((t=>t!==o))),i.childrensId?.length&&(n=e.filter((t=>t.from===i.id&&i.childrensId.includes(t.to))),n?.length&&n.forEach((o=>{t.connectors.delete(o.id)})),i.childrensId.forEach((o=>{t.blocks.get(o).parentId=null}))),t.blocks.delete(o)}},actions:{},modules:{}}),$=i(3571),A=i.n($);(0,e.ri)(I).use(E).use(A()).mount("#app")}},o={};function i(e){var n=o[e];if(void 0!==n)return n.exports;var c=o[e]={exports:{}};return t[e].call(c.exports,c,c.exports,i),c.exports}i.m=t,function(){var t=[];i.O=function(o,e,n,c){if(!e){var r=1/0;for(u=0;u<t.length;u++){e=t[u][0],n=t[u][1],c=t[u][2];for(var l=!0,s=0;s<e.length;s++)(!1&c||r>=c)&&Object.keys(i.O).every((function(t){return i.O[t](e[s])}))?e.splice(s--,1):(l=!1,c<r&&(r=c));if(l){t.splice(u--,1);var d=n();void 0!==d&&(o=d)}}return o}c=c||0;for(var u=t.length;u>0&&t[u-1][2]>c;u--)t[u]=t[u-1];t[u]=[e,n,c]}}(),function(){i.n=function(t){var o=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(o,{a:o}),o}}(),function(){i.d=function(t,o){for(var e in o)i.o(o,e)&&!i.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:o[e]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};i.O.j=function(o){return 0===t[o]};var o=function(o,e){var n,c,r=e[0],l=e[1],s=e[2],d=0;if(r.some((function(o){return 0!==t[o]}))){for(n in l)i.o(l,n)&&(i.m[n]=l[n]);if(s)var u=s(i)}for(o&&o(e);d<r.length;d++)c=r[d],i.o(t,c)&&t[c]&&t[c][0](),t[c]=0;return i.O(u)},e=self["webpackChunkreview_constructor"]=self["webpackChunkreview_constructor"]||[];e.forEach(o.bind(null,0)),e.push=o.bind(null,e.push.bind(e))}();var e=i.O(void 0,[998],(function(){return i(4991)}));e=i.O(e)})();
//# sourceMappingURL=app.8ebdef2d.js.map